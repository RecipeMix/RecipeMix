<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                template="./resources/templates/commonLayout.xhtml"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:p="http://primefaces.org/ui"
                xmlns:c="http://java.sun.com/jsp/jstl/core">
    <ui:define name="title">RecipeMix</ui:define>
    <ui:define name="content">
        <div id="frontPageWrapper">
            <p:panel>
                <p:carousel headerText="Featured Recipes"  circular="true" numVisible="1" 
                            id="featuredRecipesCarousel" pageLinks="5"
                            value="#{featured.featuredRecipes}" var="recipe" 
                            effect="easeInStrong"
                            itemStyleClass="recipeCarouselItem" widgetVar="carouselNice">
                    <p:panelGrid styleClass="featRecipeGrid" columns="2" >
                        
                        <p:column>
                            <p:graphicImage title="Recipe Image"
                                            alt="Recipe Image" url="#{recipe.imageGallery[0].imagePath}" />
                        </p:column>
                        <p:column>
                            <div class="featuredRecipeInfo">
                                <h:link id="featuredRecipeLink" value="#{recipe.recipeName}" outcome="/recipe.xhtml">
                                    <f:param name="recipe" value="#{recipe.recipeId}" />
                                </h:link>
                                <p><h:outputText id="recipeDescrip" value="#{recipe.recipeDescription}" /></p>
                            </div>
                        </p:column>
                    </p:panelGrid>
                </p:carousel>
                <c:if test="#{empty featured.featuredRecipes}" >
                            <div class="centerDiv">
                            <div>Nobody here but us chickens!</div>
                            <p:graphicImage alt="chicken" title="Cluck!" url="/resources/images/piyo.svg" />
                            </div>
                    </c:if>

                <script type="text/javascript">
                    /*The the setIntervalId here is a global parameter*/
                    var idInterval = 0;
                    function startCarousel() {
                        /*The interval in milisecond coud be passed as a parameter, here it is fixed*/
                        carouselNice.cfg.autoPlayInterval = 3000;
                        idInterval = setInterval(function() {
                            carouselNice.next();
                        }, carouselNice.cfg.autoPlayInterval);
                    }
                    $(document).ready(function() {
                        startCarousel();
                        $('#featuredRecipesCarousel').hover(function() {
                            clearInterval(idInterval);
                        }, function() {
                            startCarousel();
                        });
                        $('#featuredUsersCarousel').hover(function() {
                            clearInterval(idInterval);
                        }, function() {
                            startCarousel();
                        });
                    });
                </script>

            </p:panel>
            <div id="left">
                <p:panel styleClass="contentColumn">
                    <p:carousel  circular="true" numVisible="1" id="featuredUsersCarousel" headerText="Featured Users"
                                 value="#{featured.featuredUsers}" var="user" itemStyleClass="memberCarouselItem" widgetVar="users"> 
                        <p:graphicImage id="featuredUserImage" styleClass="rImageSmall"
                                        url="#{user.image.imagePath}" alt="#{user.image.caption}" /><br/>
                        <h:link id="featuredUserLink" value="#{user.userName}" style="display: inline" outcome="/user_profile.xhtml">
                            <f:param name="user" value="#{user.userName}" />
                        </h:link>
                    </p:carousel>
                </p:panel>
            </div>
            <div id="right">
                <p:panel styleClass="contentColumn" style="height:100%">
                    <p:dataList type="none" rows="2" paginator="TRUE" id="recentRecipes"
                                paginatorPosition="bottom" value="#{browseRecipes.recentRecipes}" var="r">
                        <f:facet name="header"><h:outputText value="Recent Recipes" /></f:facet>
                        <p:panelGrid columns="2">
                            <p:graphicImage styleClass="rImageSmall" url="/resources/images/recipe_placeholder.png" />
                            <div class="rDescrip">
                                #{r.recipeName}: 
                                #{r.recipeDescription}
                            </div>
                        </p:panelGrid>
                        <p:button styleClass="moreButton" value="More" outcome="/recipe.xhtml">
                                <f:param name="recipe" value="#{r.recipeId}" />
                            </p:button>
                    </p:dataList>
                </p:panel>
            </div>
            <div id="center">


                <p:panel styleClass="contentColumn">
                    <p:dataList type="none" rows="4" id="newsList" paginatorAlwaysVisible="false"
                                value="#{news.newsPosts}" var="n"
                                paginator="TRUE" paginatorPosition="bottom" >
                        <f:facet name="header">Site News</f:facet>
                        <p:panel>
                            <h:link id="newsLink" value="#{n.newsTitle}" outcome="/news.xhtml">
                                <f:param name="newsID" value="#{n.newsId}" />
                            </h:link>
                        </p:panel>
                    </p:dataList>
                </p:panel>
            </div>
        </div>
    </ui:define>
</ui:composition>
